name: Frontend CI/CD (Next.js to Firebase Hosting)

on:
  push:
    branches:
      - main # Altere para o nome da sua branch principal, se necessÃ¡rio
    paths:
      - 'frontend/**' # Gatilho apenas quando houver mudanÃ§as na pasta 'frontend'

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend # Define o diretÃ³rio de trabalho para a pasta 'frontend'

    steps:
      - name: Checkout do CÃ³digo
        uses: actions/checkout@v4

      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a versÃ£o do Node.js compatÃ­vel com seu Next.js

      - name: Instalar DependÃªncias e Cache
        uses: actions/cache@v4
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-
        run: npm install

      # - name: ğŸ§ª Executar Testes do Frontend (UnitÃ¡rios/E2E)
      #   # Este passo Ã© CRÃTICO. Se os testes falharem, o workflow para.
      #   run: npm run test # Assumindo que vocÃª tem um script 'test' no seu package.json do frontend
      #   env:
      #     # VariÃ¡veis de ambiente de teste, se necessÃ¡rio
      #     NODE_ENV: test

      - name: ğŸ—ï¸ Build do Next.js
        run: npm run build # Cria a build de produÃ§Ã£o (geralmente na pasta .next)

      - name: ğŸš€ Deploy para Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
          projectId: 'helpdocs-46d7f' # <-- MUDAR: ID do seu projeto Firebase
          channelId: 'live'
          # O 'public' deve ser a pasta de saÃ­da da sua build do Next.js.
          # Se vocÃª usar o Next.js com Firebase Hosting, a configuraÃ§Ã£o no firebase.json
          # (que deve estar na raiz do projeto) Ã© crucial para apontar para a pasta correta.
          # Geralmente, o Next.js usa o diretÃ³rio '.next' ou 'out' (para export estÃ¡tico).
          # Certifique-se de que seu firebase.json estÃ¡ configurado corretamente.
          entryPoint: './frontend'

      - name: Notificar Sucesso
        if: success()
        run: echo "Deploy do Frontend realizado com sucesso!"

      - name: Notificar Falha
        if: failure()
        run: echo "Falha no deploy do Frontend. Verifique os logs de teste."
